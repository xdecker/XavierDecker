<div class="product-list">
  <!-- input buscador -->
  <input
    #searchInput
    type="text"
    placeholder="Buscar producto"
    (input)="onSearch(searchInput.value)"
    class="search-input"
  />
  <div class="product-table">
    <table class="table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Nombre del producto</th>
          <th>Descripción</th>
          <th>Fecha de liberación</th>
          <th>Fecha de reestructuración</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        @if (loading) {
        <tr>
          <td colspan="6">Cargando...</td>
        </tr>
        } @else { @for (p of filteredProducts; track p.id) {
        <tr>
          <td>
            <img [src]="p.logo" class="logo" />
          </td>
          <td>{{ p.name }}</td>
          <td>{{ p.description }}</td>
          <td>{{ p.date_release | date : "yyyy-MM-dd" }}</td>
          <td>{{ p.date_revision | date : "yyyy-MM-dd" }}</td>
          <td class="actions-cell">
            <div class="dropdown" (click)="toggleDropdown(p.id)">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-three-dots-vertical"
                viewBox="0 0 16 16"
              >
                <path
                  d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"
                />
              </svg>

              <div
                class="dropdown-menu"
                *ngIf="dropdownOpen === p.id"
                (click)="$event.stopPropagation()"
              >
                <button (click)="editProduct(p)">Editar</button>
                <button (click)="confirmDelete(p)">Eliminar</button>
              </div>
            </div>
          </td>
        </tr>
        } }
      </tbody>
    </table>

    <div class="footer-table">

      <div style="width: 100%;">
        <strong>{{total}} Resultados</strong>
      </div>


      <div class="pagination">

        <select class="select-pagination" (change)="onLimitChange($event)">
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="15">15</option>
        </select>
  
        <button
          class="btn-pagination"
          [disabled]="page === 1"
          (click)="onPageChange(page - 1)"
        >
          ◀
        </button>
  
        <span>{{ page }}</span>
  
        <button
          class="btn-pagination"
          [disabled]="page * limit >= total"
          (click)="onPageChange(page + 1)"
        >
          ▶
        </button>
      </div>
    </div>

    
  </div>
</div>

<!-- Confirm dialog -->
<app-confirm-dialog
  [visible]="showConfirm"
  title="Eliminar producto"
  [message]="'¿Estas seguro de eliminar el producto ' + selectedProduct?.name + '?'"
  (confirm)="deleteConfirmed()"
  (cancel)="showConfirm = false"
>
</app-confirm-dialog>
